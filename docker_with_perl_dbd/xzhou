Patch 8.1.0567 (after 8.1.0565)
Problem:    Error for NUL byte in ScreenLines goes unnoticed.
Solution:   Add an internal error message.
Files:	    src/gui.c

Patch 8.1.0568 (after 8.1.0567)
Problem:    Error message for NUL byte in ScreenLines breaks Travis CI.
Solution:   Use a normal message fornow.
Files:	    src/gui.c

Patch 8.1.0569
Problem:    Execute() always resets display column to zero. (Sha Liu)
Solution:   Don't reset it to zero, restore the previous value. (closes #3669)
Files:	    src/evalfunc.c, src/testdir/test_execute_func.vim

Patch 8.1.0570
Problem:    'commentstring' not used when adding fold marker. (Maxim Kim)
Solution:   Only use empty 'comments' middle when leader is empty. (Christian
            Brabandt, closes #3670)
Files:	    src/misc1.c, src/testdir/test_fold.vim

Patch 8.1.0571 (after 8.1.0569)
Problem:    Non-silent execute() resets display column to zero.
Solution:   Keep the display column as-is.
Files:	    src/evalfunc.c, src/testdir/test_execute_func.vim

Patch 8.1.0572
Problem:    Stopping a job does not work properly on OpenBSD.
Solution:   Do not use getpgid() to check the process group of the job
            process ID, always pass the negative process ID to kill().
            (George Koehler, closes #3656)
Files:	    src/os_unix.c

Patch 8.1.0573
Problem:    Cannot redefine user command without ! in same script
Solution:   Allow redefining user command without ! in same script, like with
            functions.
Files:	    src/ex_docmd.c, src/testdir/test_usercommands.vim,
            runtime/doc/map.txt

Patch 8.1.0574
Problem:    'commentstring' not used when adding fold marker in C.
Solution:   Require white space before middle comment part. (mostly by
            Hirohito Higashi)
Files:	    src/misc1.c, src/testdir/test_fold.vim

Patch 8.1.0575
Problem:    Termdebug: clearing multi-breakpoint does not work.
Solution:   Delete all X.Y breakpoints.  Keep more information about placed
            breakpoints. (Ozaki Kiichi, closes #3641)
Files:	    runtime/pack/dist/opt/termdebug/plugin/termdebug.vim

Patch 8.1.0576
Problem:    Indent script tests pick up installed scripts.
Solution:   Use current runtime indent scripts.
Files:	    runtime/indent/Makefile

Patch 8.1.0577
Problem:    Tabpage right-click menu never shows "Close tab".
Solution:   Always create the "Close tab" item but ignore the event if there
            is only one tab.
Files:	    src/gui_gtk_x11.c, src/gui_mac.c, src/gui_motif.c, src/gui.c

Patch 8.1.0578
Problem:    Cannot disable arabic, rightleft and farsi in configure.
Solution:   Add configure flags. (Diego Fernando Carri√≥n, closes #1867)
Files:	    src/configure.ac, src/auto/configure, src/config.h.in,
            src/feature.h, src/Makefile

Patch 8.1.0579
Problem:    Cannot attach properties to text.
Solution:   First part of adding text properties.
Files:	    Filelist, runtime/doc/Makefile, runtime/doc/eval.txt,
            runtime/doc/textprop.txt, src/Make_all.mak, src/Make_cyg_ming.mak,
            src/Make_mvc.mak, src/Makefile, src/buffer.c, src/edit.c,
            src/evalfunc.c, src/feature.h, src/memline.c, src/misc1.c,
            src/misc2.c, src/proto.h, src/proto/memline.pro,
            src/proto/textprop.pro, src/screen.c, src/structs.h,
            src/testdir/Make_all.mak, src/testdir/test_textprop.vim,
            src/textprop.c, src/userfunc.c, src/version.c

Patch 8.1.0580
Problem:    Invalid memory access when using text properties.
Solution:   Disable text properties for now.
Files:	    src/feature.h

Patch 8.1.0581
Problem:    Double free without the text properties feature.
Solution:   Reset the dirty flag.
Files:	    src/memline.c

Patch 8.1.0582
Problem:    Text properties are not enabled.
Solution:   Fix sizeof argument and re-enable the text properties feature.
            Fix memory leak.
Files:	    src/feature.h, src/textprop.c

Patch 8.1.0583
Problem:    Using illogical name for get_dict_number()/get_dict_string().
Solution:   Rename to start with dict_.
Files:	    src/dict.c, src/proto/dict.pro, src/edit.c, src/eval.c,
            src/evalfunc.c, src/quickfix.c, src/tag.c, src/terminal.c,
            src/textprop.c

Patch 8.1.0584
Problem:    With search CTRL-L does not pick up composing characters.
Solution:   Check for composing characters. (Christian Brabandt, closes #3682)
            [code change was accidentally included in 8.1.0579]
Files:	    src/testdir/test_search.vim

Patch 8.1.0585
Problem:    Undo test may fail on MS-Windows.
Solution:   Also handle lower case drive letters.
Files:	    src/testdir/test_undo.vim

Patch 8.1.0586
Problem:    :digraph output is not easy to read.
Solution:   Add highlighting for :digraphs. (Marcin Szamotulski, closes #3572)
            Also add section headers for :digraphs!.
Files:	    src/ex_docmd.c, src/digraph.c, src/proto/digraph.pro,
            src/ex_cmds.h, runtime/doc/digraph.txt

Patch 8.1.0587
Problem:    GvimExt: realloc() failing is not handled properly.
Solution:   Check for NULL return. (Jan-Jaap Korpershoek, closes #3689)
Files:	    src/GvimExt/gvimext.cpp

Patch 8.1.0588
Problem:    Cannot define a sign with space in the text.
Solution:   Allow for escaping characters. (Ben Jackson, closes #2967)
Files:	    src/ex_cmds.c, src/testdir/test_signs.vim

Patch 8.1.0589
Problem:    Compilation error in gvimext.cpp.
Solution:   Return a value.  Also fix using uninitialized variable.
Files:	    src/GvimExt/gvimext.cpp, src/dosinst.c

Patch 8.1.0590
Problem:    When a job ends the closed channels are not handled.
Solution:   When a job is detected to have ended, check the channels again.
            (closes #3530)
Files:	    src/channel.c, src/proto/channel.pro, src/misc2.c

Patch 8.1.0591
Problem:    Channel sort test is flaky.
Solution:   Do not check if the job is running, it may have be done very fast.
Files:	    src/testdir/test_channel.vim

Patch 8.1.0592
Problem:    The libvterm tests are not run as part of Vim tests.
Solution:   Add testing libvterm.
Files:	    src/Makefile, src/libvterm/Makefile

Patch 8.1.0593
Problem:    Illegal memory access in libvterm test.
Solution:   Fix off-by-one error.
Files:	    src/libvterm/src/vterm.c, src/libvterm/Makefile,
            src/libvterm/t/run-test.pl

Patch 8.1.0594
Problem:    Libvterm tests fail to run on Mac.
Solution:   Only run libvterm tests on Linux.
Files:	    src/Makefile

Patch 8.1.0595
Problem:    Libvterm tests are not run with coverage.
Solution:   Adjust the Travis config.  Show the actually run commands.
Files:	    .travis.yml, src/libvterm/Makefile

Patch 8.1.0596
Problem:    Not all parts of printf() are tested.
Solution:   Add a few more test cases. (Dominique Pelle, closes #3691)
Files:	    src/testdir/test_expr.vim

Patch 8.1.0597
Problem:    Cannot run test_libvterm from the top directory.
Solution:   Add test target in toplevel Makefile.
Files:	    Makefile

Patch 8.1.0598
Problem:    Indent tests may use the wrong Vim binary.
Solution:   Pass in the just built Vim binary.
Files:	    Makefile

Patch 8.1.0599
Problem:    Without the +eval feature the indent tests don't work.
Solution:   Skip the body of the tests.
Files:	    runtime/indent/testdir/cleantest.vim,
            runtime/indent/testdir/runtest.vim

Patch 8.1.0600
Problem:    Channel test is flaky.
Solution:   Add test to list of flaky tests.
Files:	    src/testdir/runtest.vim

Patch 8.1.0601
Problem:    A few compiler warnings.
Solution:   Add type casts. (Mike Williams)
Files:	    src/GvimExt/gvimext.cpp, src/memline.c, src/textprop.c

Patch 8.1.0602
Problem:    DirChanged is also triggered when the directory didn't change.
            (Daniel Hahler)
Solution:   Compare the current with the new directory. (closes #3697)
Files:	    src/ex_docmd.c, src/testdir/test_autocmd.vim, src/misc2.c,
            src/testdir/test_autochdir.vim

Patch 8.1.0603
Problem:    The :stop command is not tested.
Solution:   Test :stop using a terminal window.
Files:	    src/testdir/test_terminal.vim, src/testdir/shared.vim

Patch 8.1.0604
Problem:    Autocommand test fails on MS-Windows.
Solution:   Use pathcmp() instead of strcmp() to check if a directory differs.
Files:	    src/ex_docmd.c, src/misc2.c

Patch 8.1.0605
Problem:    Running make in the top directory echoes a comment.
Solution:   Prefix with @. (closes #3698)
Files:	    Makefile

Patch 8.1.0606
Problem:    'cryptmethod' defaults to a very old method.
Solution:   Default to "blowfish2", it is now widely available.
Files:	    src/option.c, runtime/doc/options.txt

Patch 8.1.0607
Problem:    Proto files are not in sync with the source code.
Solution:   Update the proto files.
Files:	    src/os_mswin.c, src/proto/buffer.pro, src/proto/ex_cmds.pro,
            src/proto/ex_getln.pro, src/proto/misc2.pro,
            src/proto/userfunc.pro

Patch 8.1.0608
Problem:    Coveralls is not updating.
Solution:   Adjust path in Travis config.
Files:	    .travis.yml

Patch 8.1.0609
Problem:    MS-Windows: unused variable, depending on the Ruby version.
Solution:   Put ruby_sysinit and NtInitialize inside #ifdef and make them
            consistent. (Ken Takata)
Files:	    src/if_ruby.c

Patch 8.1.0610
Problem:    MS-Windows ctags file list differs from Unix.
Solution:   Define TAGS_FILES in the common makefile. (partly by Ken Takata)
Files:	    src/Make_all.mak, src/Makefile, src/Make_mvc.mak,
            src/Make_cyg_ming.mak

Patch 8.1.0611
Problem:    Crash when using terminal with long composing characters.
Solution:   Make space for all characters. (Yasuhiro Matsumoto, closes #3619,
            closes #3703)
Files:	    src/terminal.c

Patch 8.1.0612
Problem:    Cannot use two global runtime dirs with configure.
Solution:   Support a comma in --with-global-runtime. (James McCoy,
            closes #3704)
Files:	    src/config.h.in, src/configure.ac, src/feature.h, src/os_unix.h,
            src/auto/configure, src/Makefile

Patch 8.1.0613
Problem:    When executing an insecure function the secure flag is stuck.
            (Gabriel Barta)
Solution:   Restore "secure" instead of decrementing it. (closes #3705)
Files:	    src/testdir/test_autocmd.vim, src/option.c, src/buffer.c

Patch 8.1.0614
Problem:    Placing signs can be complicated.
Solution:   Add functions for defining and placing signs.  Introduce a group
            name to avoid different plugins using the same signs. (Yegappan
            Lakshmanan, closes #3652)
Files:	    runtime/doc/eval.txt, runtime/doc/sign.txt,
            runtime/doc/usr_41.txt, src/alloc.h, src/buffer.c, src/evalfunc.c,
            src/ex_cmds.c, src/globals.h, src/list.c, src/misc2.c,
            src/netbeans.c, src/proto/buffer.pro, src/proto/ex_cmds.pro,
            src/proto/list.pro, src/proto/misc2.pro, src/structs.h,
            src/testdir/test_signs.vim, src/workshop.c

Patch 8.1.0615
Problem:    Get_tv function names are not consistent.
Solution:   Rename to tv_get.
Files:	    src/eval.c, src/proto/eval.pro, src/channel.c, src/dict.c,
            src/evalfunc.c, src/list.c, src/message.c, src/tag.c,
            src/terminal.c, src/textprop.c, src/window.c, src/ex_cmds.c,
            src/os_unix.c, src/os_win32.c, src/json.c, src/regexp.c,
            src/edit.c, src/misc2.c, src/popupmnu.c

Patch 8.1.0616
Problem:    NSIS installer is outdated.
Solution:   Use modern syntax, MUI2 and make it work better. Add translations.
            (Guopeng Wen, Ken Takata, closes #3501)
Files:	    Filelist, nsis/gvim.nsi, nsis/icons/header.svg,
            nsis/icons/welcome.svg, nsis/icons/header.bmp,
            nsis/icons/un_header.bmp, nsis/icons/uninstall.bmp,
            nsis/icons/welcome.bmp, nsis/lang/danish.nsi, nsis/lang/dutch.nsi,
            nsis/lang/english.nsi, nsis/lang/german.nsi,
            nsis/lang/italian.nsi, nsis/lang/japanese.nsi,
            nsis/lang/simpchinese.nsi, nsis/lang/tradchinese.nsi,
            src/dosinst.c

Patch 8.1.0617 (after 8.1.0616)
Problem:    NSIS installer gets two files from the wrong directory.
Solution:   Change ${VIMRT} to "..\".
Files:	    nsis/gvim.nsi

Patch 8.1.0618
Problem:    term_getjob() does not return v:null as documented.
Solution:   Do return v:null. (Damien)  Add a test.
Files:	    src/terminal.c, src/testdir/test_terminal.vim

Patch 8.1.0619
Problem:    :echomsg and :echoerr do not handle List and Dict like :echo does.
            (Daniel Hahler)
Solution:   Be more tolerant about the expression result type.
Files:	    src/eval.c, src/proto/eval.pro, src/evalfunc.c,
            src/proto/evalfunc.pro, runtime/doc/eval.txt,
            src/testdir/test_messages.vim, src/message.c

Patch 8.1.0620
Problem:    Overruling CONF_ARGS from the environment no longer works. (Tony
            Mechelynck)
Solution:   Do not define any CONF_ARGS by default.
Files:	    src/Makefile

Patch 8.1.0621
Problem:    Terminal debugger does not handle unexpected debugger exit.
Solution:   Check for debugger job ended and close unused buffers. (Damien)
Files:	    runtime/pack/dist/opt/termdebug/plugin/termdebug.vim

Patch 8.1.0622
Problem:    Adding quickfix items marks items as valid errors. (Daniel Hahler)
Solution:   Check when items are valid. (Yegappan Lakshmanan, closes #3683,
            closes #3633)
Files:	    src/quickfix.c, src/testdir/test_quickfix.vim

Patch 8.1.0623
Problem:    Iterating through window frames is repeated.
Solution:   Define FOR_ALL_FRAMES. (Yegappan Lakshmanan)
Files:	    src/ex_docmd.c, src/globals.h, src/screen.c, src/window.c

Patch 8.1.0624 (after 8.1.0620)
Problem:    Overruling CONF_ARGS from the environment still does not work.
            (Tony Mechelynck)
Solution:   Add back CONF_ARGS next to the new numbered ones.
Files:	    src/Makefile

Patch 8.1.0625
Problem:    MS-Windows: terminal test fails in white console.
Solution:   Accept both white and black background colors.
Files:	    src/testdir/test_terminal.vim

Patch 8.1.0626
Problem:    MS-Windows: no resize to fit parent when using --windowid.
Solution:   Pass FALSE for "mustset" in gui_set_shellsize(). (Agorgianitis
            Loukas, closes #3616)
Files:	    src/gui.c

Patch 8.1.0627
Problem:    Python cannot handle function name of script-local function.
Solution:   Use <SNR> instead of the special byte code. (Ozaki Kiichi, closes
            #3681)
Files:	    src/if_py_both.h, src/testdir/test_python2.vim,
            src/testdir/test_python3.vim

Patch 8.1.0628
Problem:    Compiler warning on MS-Windows.
Solution:   Add type cast. (Mike Williams)
Files:	    src/if_py_both.h

Patch 8.1.0629
Problem:    "gn" selects the wrong text with a multi-line match.
Solution:   Get the end position from searchit() directly. (closes #3695)
Files:	    src/testdir/test_gn.vim, src/search.c, src/proto/search.pro,
            src/edit.c, src/evalfunc.c, src/ex_docmd.c, src/ex_getln.c,
            src/normal.c

Patch 8.1.0630
Problem:   "wincmd p" does not work after using an autocmd window.
Solution:   Store "prevwin" in aco_save_T. (Christian Brabandt, closes #3690)
Files:	    src/fileio.c, src/structs.h, src/testdir/test_window_cmd.vim

Patch 8.1.0631
Problem:    Test for :stop fails on Arch.
Solution:   Check five lines for the expected output. (closes #3714)
Files:	    src/testdir/test_terminal.vim

Patch 8.1.0632
Problem:    Using sign group names is inefficient.
Solution:   Store group names in a hash table and use a reference to them.
            Also remove unnecessary use of ":exe" from the tests.  (Yegappan
            Lakshmanan, closes #3715)
Files:	    src/buffer.c, src/ex_cmds.c, src/structs.h,
            src/testdir/test_signs.vim

Patch 8.1.0633
Problem:    Crash when out of memory while opening a terminal window.
Solution:   Handle out-of-memory more gracefully.
Files:	    src/terminal.c, src/libvterm/src/vterm.c,
            src/libvterm/src/state.c, src/libvterm/src/termscreen.c

Patch 8.1.0634
Problem:    Text properties cannot cross line boundaries.
Solution:   Support multi-line text properties.
Files:	    src/textprop.c, src/testdir/test_textprop.vim,
            runtime/doc/eval.txt

Patch 8.1.0635
Problem:    Coverity complains about null pointer use.
Solution:   Avoid using a null pointer.
Files:	    src/evalfunc.c

Patch 8.1.0636
Problem:    line2byte() gives wrong values with text properties. (Bjorn Linse)
Solution:   Compute byte offsets differently when text properties were added.
            (closes #3718)
Files:	    src/structs.h, src/textprop.c, src/proto/textprop.pro,
            src/memline.c, src/testdir/test_textprop.vim

Patch 8.1.0637
Problem:    Nsis file no longer used.
Solution:   Remove the file. (Ken Takata)
Files:	    nsis/vimrc.ini, Filelist

Patch 8.1.0638
Problem:    Text property highlighting is off by one column. (Bjorn Linse)
Solution:   Update text property highlighting earlier.  Let it overrule syntax
            highlighting.
Files:	    src/structs.h, src/screen.c

Patch 8.1.0639
Problem:    text properties test fails on MS-Windows
Solution:   Set fileformat to "unix".
Files:	    src/testdir/test_textprop.vim

Patch 8.1.0640
Problem:    Get E14 while typing command :tab with 'incsearch' set.
Solution:   Do not give an error when looking for the command. (Hirohito
            Higashi)
Files:	    src/testdir/test_search.vim, src/ex_docmd.c

Patch 8.1.0641
Problem:    No check for out-of-memory when converting regexp.
Solution:   Bail out when lalloc() returns NULL. (John Marriott)
Files:	    src/regexp_nfa.c

Patch 8.1.0642
Problem:    swapinfo() leaks memory. (Christian Brabandt)
Solution:   Avoid allocating the strings twice.
Files:	    src/memline.c, src/dict.c, src/proto/dict.pro

Patch 8.1.0643
Problem:    Computing byte offset wrong. (Bjorn Linse)
Solution:   Use the right variable for array index.
Files:	    src/memline.c, src/testdir/test_textprop.vim

Patch 8.1.0644
Problem:    Finding next sign ID is inefficient.
Solution:   Add next_sign_id. (Yegappan Lakshmanan, closes #3717)
Files:	    runtime/doc/eval.txt, src/buffer.c, src/evalfunc.c, src/ex_cmds.c,
            src/globals.h, src/main.c, src/proto/buffer.pro, src/structs.h,
            src/testdir/test_signs.vim

Patch 8.1.0645
Problem:    Coverity warns for possible use of NULL pointer.
Solution:   Check return value of vterm_obtain_screen().
Files:	    src/terminal.c

Patch 8.1.0646
Problem:    Cannot build with Ruby 2.6.0.
Solution:   Add rb_ary_detransient(). (Ozaki Kiichi, closes #3724)
Files:	    src/if_ruby.c

Patch 8.1.0647
Problem:    MS-Windows: balloon_show() does not handle wide characters.
Solution:   Use CreateWindowExW(). (Yasuhiro Matsumoto, closes #3708)
Files:	    src/gui_w32.c

Patch 8.1.0648
Problem:    Custom operators can't act upon a forced motion. (Christian
            Wellenbrock)
Solution:   Add the forced motion to the mode() result. (Christian Brabandt,
            closes #3490)
Files:	    runtime/doc/eval.txt, src/evalfunc.c, src/globals.h, src/normal.c,
            src/testdir/test_mapping.vim

Patch 8.1.0649
Problem:    setjmp() variables defined globally are used in one file.
Solution:   Move the declarations to that file.
Files:	    src/globals.h, src/os_unix.c

Patch 8.1.0650
Problem:    Command line argument -q [errorfile] is not tested.
Solution:   Add a test. (Dominique Pelle, closes #3730)
Files:	    src/testdir/test_startup.vim

Patch 8.1.0651
Problem:    :args \"foo works like :args without argument.
Solution:   Fix check for empty argument. (closes #3728)
Files:	    src/ex_cmds2.c, src/testdir/test_arglist.vim

Patch 8.1.0652
Problem:    Freeing memory for balloon eval too early.
Solution:   Store the pointer in BalloonEval and free it later. (Yasuhiro
            Matsumoto, closes #3725)
Files:	    src/beval.h, src/gui_w32.c

Patch 8.1.0653 (after 8.1.0651)
Problem:    Arglist test fails on MS-windows.
Solution:   Only use a file name with a double quote on Unix.
Files:	    src/testdir/test_arglist.vim

Patch 8.1.0654
Problem:    When deleting a line text property flags are not adjusted.
Solution:   Adjust text property flags in preceding and following lines.
Files:	    src/memline.c, src/misc2.c, src/proto/misc2.pro,
            src/testdir/test_textprop.vim

Patch 8.1.0655
Problem:    When appending a line text property flags are not added.
Solution:   Add text properties to a newly added line.
Files:	    src/memline.c, src/testdir/test_textprop.vim, src/textprop.c

Patch 8.1.0656
Problem:    Trying to reconnect to X server may cause problems.
Solution:   Do no try reconnecting when exiting. (James McCoy)
Files:	    src/os_unix.c

Patch 8.1.0657 (after 8.1.0656)
Problem:    Get error for using regexp recursively. (Dominique Pelle)
Solution:   Do no check if connection is desired.
Files:	    src/os_unix.c

Patch 8.1.0658
Problem:    Deleting signs and completion for :sign is insufficient.
Solution:   Add deleting signs in a specified or any group from the current
            cursor location.  Add group and priority to sign command
            completion. Add tests for different sign unplace commands. Update
            help text.  Add tests for sign jump with group. Update help for
            sign jump. (Yegappan Lakshmanan, closes #3731)
Files:	    runtime/doc/sign.txt, src/buffer.c, src/evalfunc.c, src/ex_cmds.c,
            src/netbeans.c, src/proto/buffer.pro, src/proto/ex_cmds.pro,
            src/testdir/test_signs.vim

Patch 8.1.0659 (after 8.1.0658)
Problem:    Build failure without the sign feature.
Solution:   Put the sign struct declarations outside of the #ifdef.
Files:	    src/structs.h

Patch 8.1.0660
Problem:    sign_unplace() may leak memory.
Solution:   Free the group name before returning.  Add a few more tests.
            (Yegappan Lakshmanan)
Files:	    src/evalfunc.c, src/testdir/test_signs.vim

Patch 8.1.0661
Problem:    Clipboard regexp might be used recursively.
Solution:   Check for recursive use and bail out.
Files:	    src/regexp.c, src/proto/regexp.pro, src/os_unix.c

Patch 8.1.0662
Problem:    Needlessly searching for tilde in string.
Solution:   Only check the first character. (James McCoy, closes #3734)
Files:	    src/misc1.c

Patch 8.1.0663
Problem:    Text property display wrong when 'number' is set. (Dominique
            Pelle)
Solution:   Compare with "vcol"  instead of "col".
Files:	    src/screen.c

Patch 8.1.0664
Problem:    Configure "fail-if-missing" does not apply to the enable-gui
            argument. (Rhialto)
Solution:   Make configure fail if a GUI was specified and "fail-if-missing"
            is enabled and the GUI test fails.
Files:	    src/configure.ac, src/auto/configure

Patch 8.1.0665
Problem:    Text property display wrong when 'spell' is set. (Dominique Pelle)
Solution:   Remove unnecessary assignment to char_attr.  Combine attributes if
            needed.  Add a screenshot test.
Files:	    src/screen.c, src/testdir/test_textprop.vim,
            src/testdir/dumps/Test_textprop_01.dump

Patch 8.1.0666 (after 8.1.0665)
Problem:    Text property test fails.
Solution:   Update screenshot.
Files:	    src/testdir/dumps/Test_textprop_01.dump

Patch 8.1.0667 (after 8.1.0665)
Problem:    Textprop test leaves file behind.
Solution:   Delete the file. (Dominique Pelle, closes #3743)
Files:	    src/testdir/test_textprop.vim

Patch 8.1.0668
Problem:    No test for overstrike mode in the command line.
Solution:   Add a test. (Dominique Pelle, closes #3742)
Files:	    src/testdir/test_cmdline.vim

Patch 8.1.0669
Problem:    The ex_sign() function is too long.
Solution:   Refactor the function.  Add a bit more testing. (Yegappan
            Lakshmanan, closes #3745)
Files:	    src/testdir/test_signs.vim, src/ex_cmds.c

Patch 8.1.0670
Problem:    Macro for popup menu width is unused.
Solution:   Remove it. (Hirohito Higashi)
Files:	    src/popupmnu.c

Patch 8.1.0671
Problem:    Cursor in the wrong column after auto-formatting.
Solution:   Check for deleting more spaces than adding. (closes #3748)
Files:	    src/ops.c, src/testdir/test_textformat.vim, src/mark.c,
            src/proto/mark.pro, src/misc1.c

Patch 8.1.0672
Problem:    The Lua interface doesn't know about v:null.
Solution:   Add Lua support for v:null. (Uji, closes #3744)
Files:	    src/if_lua.c, src/testdir/test_lua.vim

Patch 8.1.0673
Problem:    Functionality for signs is spread out over several files.
Solution:   Move most of the sign functionality into sign.c. (Yegappan
            Lakshmanan, closes #3751)
Files:	    Filelist, src/Make_bc5.mak, src/Make_cyg_ming.mak,
            src/Make_dice.mak, src/Make_ivc.mak, src/Make_manx.mak,
            src/Make_morph.mak, src/Make_mvc.mak, src/Make_sas.mak,
            src/Make_vms.mms, src/Makefile, src/README.txt, src/buffer.c,
            src/evalfunc.c, src/ex_cmds.c, src/proto.h, src/proto/buffer.pro,
            src/proto/ex_cmds.pro, src/proto/sign.pro, src/sign.c

Patch 8.1.0674
Problem:    Leaking memory when updating a single line.
Solution:   Do not call start_search_hl() twice.
Files:	    src/screen.c

Patch 8.1.0675
Problem:    Text property column is screen columns is not practical.
Solution:   Use byte values for the column.
Files:	    src/structs.h, src/textprop.c, src/proto/textprop.pro,
            runtime/doc/eval.txt, runtime/doc/textprop.txt,
            src/testdir/test_textprop.vim,
            src/testdir/dumps/Test_textprop_01.dump

Patch 8.1.0676
Problem:    Textprop screendump test fails.
Solution:   Add missing changes.
Files:	    src/screen.c

Patch 8.1.0677
Problem:    Look-behind match may use the wrong line number. (Dominique Pelle)
Solution:   Use the line number in regsave instead of the one in behind_pos,
            we may be looking at the previous line. (closes #3749)
Files:	    src/regexp.c

Patch 8.1.0678
Problem:    Text properties as not adjusted for inserted text.
Solution:   Adjust text properties when inserting text.
Files:	    src/misc1.c, src/proto/misc1.pro, src/textprop.c,
            src/testdir/test_textprop.vim,
            src/testdir/dumps/Test_textprop_01.dump

Patch 8.1.0679
Problem:    Sign functions do not take buffer argument as documented.
Solution:   Use get_buf_tv(). (Yegappan Lakshmanan, closes #3755)
Files:	    src/evalfunc.c, src/testdir/test_signs.vim

Patch 8.1.0680
Problem:    Not easy to see what features are unavailable.
Solution:   Highlight disabled features in the :version output. (Nazri Ramliy,
            closes #3756)
Files:	    src/version.c

Patch 8.1.0681
Problem:    Text properties as not adjusted for deleted text.
Solution:   Adjust text properties when backspacing to delete text.
Files:	    src/edit.c, src/misc1.c, src/testdir/test_textprop.vim,
            src/testdir/dumps/Test_textprop_01.dump

Patch 8.1.0682
Problem:    Text properties are not adjusted when backspacing replaced text.
Solution:   Keep text properties on text restored in replace mode.
Files:	    src/edit.c, src/textprop.c,  src/globals.h,
            src/testdir/test_textprop.vim

Patch 8.1.0683
Problem:    Spell highlighting does not always end. (Gary Johnson)
Solution:   Also reset char_attr when spell errors are highlighted.
Files:	    src/screen.c

Patch 8.1.0684
Problem:    Warnings from 64-bit compiler.
Solution:   Add type casts. (Mike Williams)
Files:	    src/memline.c, src/textprop.c

Patch 8.1.0685
Problem:    get_buf_tv() is named inconsistently.
Solution:   Rename it to tv_get_buf(). (Yegappan Lakshmanan, closes #3759)
Files:	    src/evalfunc.c, src/proto/evalfunc.pro, src/terminal.c,
            src/textprop.c

Patch 8.1.0686
Problem:    When 'y' is in 'cpoptions' yanking for the clipboard changes redo.
Solution:   Do not use the 'y' flag when "gui_yank" is TRUE. (Andy Massimino,
            closes #3760)
Files:	    src/normal.c

Patch 8.1.0687
Problem:    Sentence text object in Visual mode is not tested.
Solution:   Add a test. (Dominique Pelle, closes #3758)
Files:	    src/testdir/test_visual.vim

Patch 8.1.0688
Problem:    Text properties are not restored by undo.
Solution:   Also save text properties for undo.
Files:	    src/structs.h, src/undo.c, src/memline.c, src/proto/memline.pro

Patch 8.1.0689 (after 8.1.0688)
Problem:    Undo with text properties not tested.
Solution:   Add a test function.
Files:	    src/testdir/test_textprop.vim

Patch 8.1.0690
Problem:    setline() and setbufline() do not clear text properties.
Solution:   Clear text properties when setting the text.
Files:	    src/evalfunc.c, src/testdir/test_textprop.vim

Patch 8.1.0691
Problem:    Text properties are not adjusted for :substitute.
Solution:   Adjust text properties as well as possible.
Files:	    src/ex_cmds.c, src/textprop.c, src/proto/textprop.pro,
            src/testdir/test_textprop.vim

Patch 8.1.0692
Problem:    If a buffer was deleted a channel can't write to it.
Solution:   When the buffer exists but was unloaded, prepare it for writing.
            (closes #3764)
Files:	    src/channel.c, src/testdir/test_channel.vim

Patch 8.1.0693 (after 8.1.0692)
Problem:    Channel test fails sometimes.
Solution:   Avoid race condition.
Files:	    src/testdir/test_channel.vim

Patch 8.1.0694
Problem:    When using text props may free memory that is not allocated.
            (Andy Massimino)
Solution:   Allocate the line when adjusting text props. (closes #3766)
Files:	    src/textprop.c

Patch 8.1.0695
Problem:    Internal error when using :popup.
Solution:   When a menu only exists in Terminal mode give an error. (Naruhiko
            Nishino, closes #3765)
Files:	    runtime/doc/gui.txt, src/globals.h, src/menu.c, src/popupmnu.c,
            src/testdir/test_popup.vim

Patch 8.1.0696
Problem:    When test_edit fails 'insertmode' may not be reset and the next
            test may get stuck. (James McCoy)
Solution:   Always reset 'insertmode' after executing a test.  Avoid that an
            InsertCharPre autocommand or a 'complete' function can change the
            state. (closes #3768)
Files:	    src/testdir/runtest.vim, src/edit.c

Patch 8.1.0697
Problem:    ":sign place" requires the buffer argument.
Solution:   Make the argument optional.  Also update the help and clean up the
            sign test. (Yegappan Lakshmanan, closes #3767)
Files:	    runtime/doc/eval.txt, runtime/doc/sign.txt, src/sign.c,
            src/testdir/test_signs.vim

Patch 8.1.0698
Problem:    Clearing the window is used too often, causing the command line
            to be cleared when opening a tab. (Miroslav Ko≈°k√°r)
Solution:   Use NOT_VALID instead of CLEAR.  (suggested by Jason Franklin,
            closes #630)  Also do this for a few other places where clearing
            the screen isn't really needed.
Files:	    src/window.c

Patch 8.1.0699
Problem:    Compiler warning for uninitialized variable. (Tony Mechelynck)
Solution:   Add a dummy init.
Files:	    src/edit.c

Patch 8.1.0700 (after 8.1.0698)
Problem:    Using "gt" sometimes does not redraw a tab. (Jason Franklin)
Solution:   Always set must_redraw in redraw_all_later().
Files:	    src/screen.c

Patch 8.1.0701
Problem:    Sign message not translated and inconsistent spacing.
Solution:   Add _() for translation.  Add a space. (Ken Takata)  Also use
            MSG_BUF_LEN instead of BUFSIZ.
Files:	    src/sign.c, src/testdir/test_signs.vim

Patch 8.1.0702
Problem:    ":sign place" only uses the current buffer.
Solution:   List signs for all buffers when there is no buffer argument.
            Fix error message for invalid buffer name in sign_place().
            (Yegappan Lakshmanan, closes #3774)
Files:	    runtime/doc/eval.txt, src/evalfunc.c, src/sign.c,
            src/testdir/test_signs.vim

Patch 8.1.0703
Problem:    Compiler warnings with 64-bit compiler.
Solution:   Change types, add type casts. (Mike Williams)
Files:	    src/textprop.c, src/undo.c

Patch 8.1.0704
Problem:    Building with Ruby 2.6 gives compiler warnings.
Solution:   Define a stub for rb_ary_detransient. (Ozaki Kiichi, closes #3779)
Files:	    src/if_ruby.c

Patch 8.1.0705
Problem:    :colorscheme isn't tested enough
Solution:   Improve test coverage of :colorscheme. (Dominique Pelle, closes
            #3777)  Remove unnecessary sleep.
Files:	    src/testdir/test_gui.vim

Patch 8.1.0706
Problem:    Tabline is not always redrawn when something that is used in
            'tabline' changes.
Solution:   Add ":redrawtabline" so that a plugin can at least cause the
            redraw when needed.
Files:	    runtime/doc/various.txt, runtime/doc/options.txt, src/ex_docmd.c,
            src/ex_cmds.h, src/screen.c, src/proto/screen.pro,
            src/ex_cmdidxs.h, src/testdir/test_tabline.vim

Patch 8.1.0707
Problem:    Text property columns are not adjusted for changed indent.
Solution:   Adjust text properties.
Files:	    src/misc1.c, src/testdir/test_textprop.vim

Patch 8.1.0708
Problem:    Third argument for redrawWinline() is always FALSE.
Solution:   Drop the argument. (neovim #9479)
Files:	    src/edit.c, src/move.c, src/screen.c, src/proto/screen.pro

Patch 8.1.0709
Problem:    Windows are updated for every added/deleted sign.
Solution:   Do not call update_debug_sign().  Only redraw when the line with
            the sign is visible.  (idea from neovim #9479)
Files:	    src/sign.c, src/screen.c, src/proto/screen.pro

Patch 8.1.0710
Problem:    When using timers may wait for job exit quite long.
Solution:   Return from ui_wait_for_chars_or_timer() when a job or channel
            needs to be handled. (Ozaki Kiichi, closes #3783)
Files:	    src/ui.c, src/testdir/test_channel.vim

Patch 8.1.0711
Problem:    Test files still use function!.
Solution:   Remove the exclamation mark.  Fix overwriting a function.
Files:	    src/testdir/test49.vim, src/testdir/test_autocmd.vim,
            src/testdir/test_charsearch.vim,
            src/testdir/test_charsearch_utf8.vim,
            src/testdir/test_display.vim, src/testdir/test_edit.vim,
            src/testdir/test_eval_func.vim, src/testdir/test_fnameescape.vim,
            src/testdir/test_getcwd.vim, src/testdir/test_highlight.vim,
            src/testdir/test_hlsearch.vim, src/testdir/test_ins_complete.vim,
            src/testdir/test_lambda.vim, src/testdir/test_listdict.vim,
            src/testdir/test_listlbr.vim, src/testdir/test_listlbr_utf8.vim,
            src/testdir/test_marks.vim, src/testdir/test_matchadd_conceal.vim,
            src/testdir/test_matchadd_conceal_utf8.vim,
            src/testdir/test_messages.vim, src/testdir/test_number.vim,
            src/testdir/test_options.vim, src/testdir/test_partial.vim,
            src/testdir/test_smartindent.vim, src/testdir/test_substitute.vim,
            src/testdir/test_system.vim, src/testdir/test_terminal.vim,
            src/testdir/test_textobjects.vim, src/testdir/test_utf8.vim,
            src/testdir/test_utf8_comparisons.vim,
            src/testdir/test_vartabs.vim, src/testdir/test_vimscript.vim,
            src/testdir/test_window_cmd.vim, src/testdir/test_xxd.vim

Patch 8.1.0712
Problem:    MS-Windows build instructions are a bit outdated.
Solution:   Update the instructions. (Ken Takata)
Files:	    src/INSTALLpc.txt

Patch 8.1.0713
Problem:    Images for NSIS take up too much space.
Solution:   Put the images in a zip file.
Files:	    nsis/icons.zip, nsis/icons/disabled.bmp, nsis/icons/enabled.bmp,
            nsis/icons/header.bmp, nsis/icons/header.svg,
            nsis/icons/un_header.bmp, nsis/icons/uninstall.bmp,
            nsis/icons/vim_16c.ico, nsis/icons/vim_uninst_16c.ico,
            nsis/icons/welcome.bmp, nsis/icons/welcome.svg,
            nsis/README.txt, Filelist, Makefile

Patch 8.1.0714
Problem:    Unnecessary #if lines in GTK code.
Solution:   Remove the #if. (Ken Takata, closes #3785)
Files:	    src/gui_beval.c, src/if_mzsch.c

Patch 8.1.0715
Problem:    Superfluous call to redraw_win_later().
Solution:   Remove the call.
Files:	    src/move.c

Patch 8.1.0716
Problem:    Get warning message when 'completefunc' returns nothing.
Solution:   Allow for returning v:none to suppress the warning message.
            (Yasuhiro Matsumoto, closes #3789)
Files:	    runtime/doc/insert.txt, src/edit.c,
            src/testdir/test_ins_complete.vim

Patch 8.1.0717
Problem:    There is no function for the ":sign jump" command.
Solution:   Add the sign_jump() function. (Yegappan Lakshmanan, closes #3780)
Files:	    runtime/doc/eval.txt, runtime/doc/sign.txt,
            runtime/doc/usr_41.txt, src/evalfunc.c, src/proto/sign.pro,
            src/sign.c, src/testdir/test_signs.vim

Patch 8.1.0718
Problem:    A couple compiler warnings.
Solution:   Rename shadowed variables.  Add UNUSED.
Files:	    src/misc1.c

Patch 8.1.0719
Problem:    Too many #ifdefs.
Solution:   Always build with the +visualextra feature.
Files:	    src/evalfunc.c, src/version.c, src/normal.c, src/ops.c,
            src/feature.h, runtime/doc/various.txt

Patch 8.1.0720
Problem:    Cannot easily change the current quickfix list index.
Solution:   Add the "idx" argument to setqflist(). (Yegappan Lakshmanan,
            closes #3701)
Files:	    runtime/doc/eval.txt, runtime/doc/quickfix.txt, src/quickfix.c,
            src/testdir/test_quickfix.vim

Patch 8.1.0721
Problem:    Conceal mode is not sufficiently tested.
Solution:   Add screendump tests.  Check all 'concealcursor' values.
Files:	    src/testdir/test_conceal.vim, src/Make_all.mak,
            src/testdir/Make_all.mak
            src/testdir/dumps/Test_conceal_two_windows_01.dump,
            src/testdir/dumps/Test_conceal_two_windows_02.dump,
            src/testdir/dumps/Test_conceal_two_windows_03.dump,
            src/testdir/dumps/Test_conceal_two_windows_04.dump,
            src/testdir/dumps/Test_conceal_two_windows_05.dump,
            src/testdir/dumps/Test_conceal_two_windows_06i.dump,
            src/testdir/dumps/Test_conceal_two_windows_06v.dump,
            src/testdir/dumps/Test_conceal_two_windows_06c.dump,
            src/testdir/dumps/Test_conceal_two_windows_06n.dump,
            src/testdir/dumps/Test_conceal_two_windows_07i.dump,
            src/testdir/dumps/Test_conceal_two_windows_07v.dump,
            src/testdir/dumps/Test_conceal_two_windows_07c.dump,
            src/testdir/dumps/Test_conceal_two_windows_07n.dump,
            src/testdir/dumps/Test_conceal_two_windows_08i.dump,
            src/testdir/dumps/Test_conceal_two_windows_08v.dump,
            src/testdir/dumps/Test_conceal_two_windows_08c.dump,
            src/testdir/dumps/Test_conceal_two_windows_08n.dump,
            src/testdir/dumps/Test_conceal_two_windows_09i.dump,
            src/testdir/dumps/Test_conceal_two_windows_09v.dump,
            src/testdir/dumps/Test_conceal_two_windows_09c.dump,
            src/testdir/dumps/Test_conceal_two_windows_09n.dump

Patch 8.1.0722
Problem:    Cannot build without the virtualedit feature.
Solution:   Make getviscol2() always available.
Files:	    src/misc2.c, src/proto/misc2.pro, src/ops.c

Patch 8.1.0723
Problem:    Cannot run specific test when in src/testdir the same was as in
            the src directory.
Solution:   Move build rule to src/testdir/Makefile.
Files:	    src/testdir/Make_all.mak, src/testdir/Make_amiga.mak,
            src/testdir/Make_dos.mak, src/testdir/Make_ming.mak,
            src/Makefile, src/Make_all.mak, src/testdir/Makefile,
            src/testdir/README.txt, src/Make_mvc.mak

Patch 8.1.0724
Problem:    Build for MinGW fails.
Solution:   Avoid specifying dependencies in included makefile.
Files:	    src/testdir/Make_all.mak, src/testdir/Makefile,
            src/testdir/Make_dos.mak, src/testdir/Make_ming.mak

Patch 8.1.0725
Problem:    Conceal mode is not completely tested.
Solution:   Add tests for moving the cursor in Insert mode.
Files:	    src/testdir/test_conceal.vim,
            src/testdir/dumps/Test_conceal_two_windows_10.dump,
            src/testdir/dumps/Test_conceal_two_windows_11.dump,
            src/testdir/dumps/Test_conceal_two_windows_12.dump,
            src/testdir/dumps/Test_conceal_two_windows_13.dump

Patch 8.1.0726
Problem:    Redrawing specifically for conceal feature.
Solution:   Use generic redrawing methods.
Files:	    src/edit.c, src/gui.c, src/main.c, src/normal.c, src/screen.c,
            src/proto/screen.pro, src/window.c

Patch 8.1.0727
Problem:    Compiler warning for sprintf() argument.
